<div id="ConsoleContainer">
	<aside id="ConsoleMenu" ng-if="console.ActiveContext">
		<ul class="section-list">
			<li ng-repeat-start="section in console.Sections">
				{{section}}
			</li>
			<div ng-repeat-end>
				<ul class="resource-list">
					<li ng-repeat="resource in console.Resources | filter:{Section:section}">
						<a href="" ng-class="{active:console.SelectedResource.Name == resource.Name}" ng-click="console.SelectResource(this)">{{resource.Name}}</a>
					</li>
				</ul>
			</div>
		</ul>

<!--		<div class="list-group console-menu">
			<button type="button" class="list-group-item"
					ng-class="{active:console.SelectedResource.Name == resource.Name}"
					ng-repeat="resource in console.Resources | orderBy:'+Section'" ng-click="console.SelectResource(this)">{{resource.Name}} &lt;!&ndash;<span class="badge">{{resource.methods.length}}</span>&ndash;&gt;</button>
		</div>-->
	</aside>

	<article class="container" ng-if="!console.SelectedResource">
		<h3 class="page-header"><i class="fa fa-tools"></i>API Console</h3>
		<div id="ContextSettings" class="well" ng-init="ContextMenuOpen = false">
			<h4 ng-click="ContextMenuOpen = !ContextMenuOpen">Select a Context <i class="fa fa-chevron-right" ng-class="{'fa-rotate-90':ContextMenuOpen}"></i></h4>
			<div uib-collapse="!ContextMenuOpen">
				<div ng-click="console.SelectedContext = context" ng-class="{active:console.ActiveContext == context, selected: console.SelectedContext == context}" ng-repeat="context in console.AvailableContexts">
					<b>Company: </b>{{context.AppName}}<br/>
					<b>User: </b>{{context.UserName}}<br/>
					<small class="text-muted">{{context.ClientID}}</small>
				</div>
			</div>
		</div>
		<form name="ContextSettings" ng-submit="console.setContext(console.SelectedContext)" novalidate>
			<div class="input-group">
				<select class="form-control" ng-model="console.SelectedContext" ng-options="context as context.AppName for context in console.AvailableContexts" required></select>
				<span class="input-group-btn">
					<button type="submit" class="btn btn-primary" ng-disabled="ContextSettings.$invalid">Set Context</button>
				</span>
			</div>
		</form>
		<hr/>

		<p>Welcome to the OrderCloud API Console!  The purpose of this tool is to give developers an idea of how the OrderCloud RESTful API is structured through an interactive UI.</p>
		<p>Begin by choosing a resource from the left and then specify an endpoint in the drop-down.  If the selected endpoint has parameters available, fill these out by clicking "params" to the right of the endpoint.  When creating and updating you will often need to provide a request body as well.  These request bodies will always be in <code>JSON</code> format and is editable below the endpoint selector.</p>
		<p class="alert alert-danger">Keep in mind that <b>this <em>will</em> alter your database</b>, and changes will be immediately reflected in any application using your distributor companies' client id.</p>
	</article>
	<div id="Console" ng-if="console.SelectedResource">
		<article id="Request">
			<div id="ContextSettings" class="well" ng-init="ContextMenuOpen = false">
				<div ng-show="!ContextMenuOpen" ng-click="ContextMenuOpen = true">
					<b>Company: </b>{{console.ActiveContext.AppName}}<br/>
					<b>User: </b>{{console.ActiveContext.UserName}}<br/>
					<small class="text-muted">{{console.ActiveContext.ClientID}}</small>
				</div>
				<h4 ng-show="ContextMenuOpen" ng-click="ContextMenuOpen = false">Select a Context <i class="fa fa-chevron-right" ng-class="{'fa-rotate-90':ContextMenuOpen}"></i></h4>
				<div uib-collapse="!ContextMenuOpen">
					<div ng-click="console.setContext(context)" ng-class="{active:console.ActiveContext == context}" ng-repeat="context in console.AvailableContexts">
						<b>Company: </b>{{context.AppName}}<br/>
						<b>User: </b>{{context.UserName}}<br/>
						<small class="text-muted">{{context.ClientID}}</small>

					</div>
				</div>
			</div>
			<h3 class="page-title">
				{{console.SelectedResource.Name}}
				<small ng-bind="console.SelectedEndpoint.Name"></small>
			</h3>
			<!--		<p ng-bind-html="comment | markdown" ng-repeat="comment in console.SelectedResource.Documentation.Comments"></p>
					<p ng-bind-html="comment | markdown" ng-repeat="comment in console.SelectedEndpoint.Comments"></p>-->
			<section class="console-selector">
				<span uib-dropdown>
				  <a href uib-dropdown-toggle>
					  {{console.SelectedEndpoint.ID || 'Method'}} <span class="caret"></span>
				  </a>
				  <ul uib-dropdown-menu>
					  <li ng-repeat="endpoint in console.SelectedResource.Endpoints" ng-class="{active:console.SelectedEndpoint.ID == endpoint.ID}">
						  <a href ng-click="console.SelectEndpoint(this)">{{endpoint.ID}}</a>
					  </li>
				  </ul>
				</span>
					<pre>{{console.SelectedEndpoint.UriTemplate}}</pre>
				<!--<span class="btn btn-link" ng-if="console.SelectedEndpoint && console.SelectedEndpoint.Parameters.length" ng-click="console.SelectedEndpoint.showParams = !console.SelectedEndpoint.showParams">
					Params
				</span>-->
				<button class="btn btn-primary" ng-click="console.Execute()" ng-disabled="!console.SelectedEndpoint">Send <i class="fa fa-send-o"></i></button>
			</section>
			<section id="Configuration" ng-if="console.SelectedEndpoint">
				<table class="table" ng-if="console.SelectedEndpoint.Parameters.length">
					<thead>
					<tr>
						<th>Name</th>
						<th>Type</th>
						<th>Value</th>
					</tr>
					</thead>
					<tbody>
					<tr ng-repeat="param in console.SelectedEndpoint.Parameters | filter:{Name: '!filters'}">
						<td>{{param.Name}} <small class="text-muted" ng-if="!param.Required">(optional)</small></td>
						<td><div class="label" ng-class="{
								'label-primary': param.Type == 'string',
								'label-warning': param.Type == 'boolean',
								'label-info': param.Type == 'integer'
							}">{{param.Type}}</div></td>
						<td>
							<div ng-class="{'input-group': param.Lockable}">
								<input type="{{param.Type == 'integer' ? 'number' : 'text'}}" class="form-control"
									   uib-tooltip="{{param.Description}}"
									   tooltip-trigger="focus"
									   ng-model="param.Value" ng-required="param.Required" ng-disabled="console.isLocked(param.Name)"/>
									<span class="input-group-btn" ng-if="param.Lockable">
										<button class="btn btn-default" ng-click="console.isLocked(param.Name) ? console.unlockParam(param.Name) : console.lockParam(param.Name, param.Value)" ng-disabled="!param.Value" uib-tooltip="{{console.isLocked(param.Name) ? 'Unlock Value' : 'Lock Value'}}" tooltip-append-to-body="true" tooltip-placement="left">
											<i class="fa" ng-class="{'fa-lock': console.isLocked(param.Name), 'fa-unlock-alt': !console.isLocked(param.Name)}"></i>
										</button>
									</span>
							</div>
						</td>
					</tr>
					<!--<tr ng-repeat="field in console.SelectedMethod.ResolvedParameters.Fields">
						<td>{{field.Name}} <small class="text-muted" ng-if="!field.Required">(optional)</small></td>
						<td><div class="label" ng-class="{
								'label-primary': field.Type == 'string',
								'label-warning': field.Type == 'boolean',
								'label-info': field.Type == 'integer'
							}">{{field.Type}}</div></td>
						<td>
							<div ng-class="{'input-group': field.Lockable}">
								<input type="{{field.Type == 'integer' ? 'number' : 'text'}}" class="form-control"
									   uib-tooltip="{{field.Description}}"
									   tooltip-trigger="focus"
									   ng-model="field.Value" ng-required="field.Required" ng-disabled="console.isLocked(field.Name)"/>
								<span class="input-group-btn" ng-if="field.Lockable">
									<button class="btn btn-default" ng-click="console.isLocked(field.Name) ? console.unlockParam(field.Name) : console.lockParam(field.Name, field.Value)" ng-disabled="!field.Value" uib-tooltip="{{console.isLocked(field.Name) ? 'Unlock Value' : 'Lock Value'}}" tooltip-append-to-body="true" tooltip-placement="left">
										<i class="fa" ng-class="{'fa-lock': console.isLocked(field.Name), 'fa-unlock-alt': !console.isLocked(field.Name)}"></i>
									</button>
								</span>
							</div>
						</td>
					</tr>-->
					</tbody>
				</table>
				<table class="table" ng-if="console.SelectedEndpoint.Filters">
					<colgroup>
						<col/>
						<col/>
						<col style="width:50px;"/>
					</colgroup>
					<thead ng-if="console.SelectedEndpoint.Filters.length">
					<tr>
						<th>Key</th>
						<th colspan="2">Value</th>
					</tr>
					</thead>
					<tbody>
					<tr ng-repeat="filter in console.SelectedEndpoint.Filters">
						<td><input class="form-control" type="text" ng-model="filter.Key" /></td>
						<td><input class="form-control" type="text" ng-model="filter.Value" /></td>
						<td><button class="btn btn-danger btn-block"><i class="fa fa-minus-circle" ng-click="console.removeFilter($index)"></i></button></td>
					</tr>
					<tr>
						<td colspan="3" ng-click="console.addNewFilter()"><button class="btn btn-default btn-block"><i class="fa fa-plus"></i> Add New Filter</button></td>
					</tr>
					</tbody>
				</table>
				<div ng-if="console.SelectedEndpoint.RequestBody">
					<p class="page-header">
						Request Body
					</p>
					<div ui-ace="{
						onLoad: console.setMaxLines,
						useWrapMode : true,
						theme:'twilight',
						mode: 'json',
						tabSize: '4',
						useSoftTabs: true,
						showPrintMargin: false
					}" ng-model="console.SelectedEndpoint.RequestBody.Value">
					</div>
				</div>
											<!--<pre>{{console.SelectedResource.name + '.' + console.SelectedMethod.name + '('}}<span ng-repeat="p in console.SelectedMethod.resolvedParameters">{{((p.Value != null && p.Value != '') ? (p.Type == 'text' ? ('\'' + p.Value + '\'') : p.Value) : p.Name) + (!$last ? ', ' : ')') }}</span></pre>-->
			</section>

		</article>
		<div id="Response">
			<div id="ResponseList">
				<div class="log-item-container" ng-repeat="response in console.Responses | orderBy:'+':true">
					<div class="log-item">
						<div class="apiRequestDisplay" ng-class="{success: (response.status < 300 && response.status >= 200), danger: (response.status >= 300 || response.status < 200), disabled: response != console.SelectedResponse}" ng-click="console.SelectResponse(response)">
							<pre>{{response.config.method}}</pre>
							<pre><i class="fa pull-right" ng-class="{'fa-check':(response.status < 300 && response.status >= 200), 'fa-warning': (response.status >= 300 || response.status < 200)}"></i>{{(response.config.url | OCRoutingUrl) + (response.config.params | OCUrlParams)}} <small>{{response.status + ' ' + response.statusText}}</small></pre>
						</div>
					</div>
				</div>
			</div>
			<div id="ResponseBody" readonly ui-ace="{
				useWrapMode : true,
				theme:'twilight',
				mode: 'json',
				tabSize: '4',
				useSoftTabs: true,
				showPrintMargin: false,
				showGutter: false
			}" ng-model="console.SelectedResponse.data"></div>
		</div>
	</div>
</div>

